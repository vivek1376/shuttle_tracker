<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>shuttle tracker</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="reset.css">
    <link rel="stylesheet" type="text/css" href="style.css">
    <!--<link rel="shortcut icon" href="">-->
</head>
<body>
<div id="left-pane">
    <input type="text" id="map_search">
    <select id="route" name=routes">
        <option value="routeA"><route></route> A</option>
        <option value="routeB">route B</option>
        <option value="north">northRoute</option>
    </select>
    <select id="stop" name="Stops">
        <option value="stopA">stop A</option>
        <option value="stopB">stop B</option>
    </select>
    <div id="info">
        <p>A</p>
        <p>B</p>
    </div>
</div>

<div id="trackInfo">sdfdsf<br>sdfsf23424

    3424234234
</div>
<div id="map">

</div>
<a href="#">Sign In</a>
<script>
    var map;
    function initMap() {
        var loc = {lat: 39.1031, lng: -84.5120};

        // var coord_path = [
        //     {lat: 39.1, lng: -84.5},
        //     {lat: 39.3, lng: -84.4},
        //     {lat: 39.0, lng: -84.7},
        //     {lat: 39.5, lng: -84.0}
        // ];
        //
        // var Path = new google.maps.Polyline({
        //     path: coord_path,
        //     geodesic: true,
        //     strokeColor: '#FF0000',
        //     strokeOpacity: 1.0,
        //     strokeWeight: 2
        // });

        map = new google.maps.Map(document.getElementById('map'), {
            center: loc,
            zoom: 14,
            mapTypeId: 'roadmap',
            disableDefaultUI: true,
            gestureHandling: 'cooperative'
        });

        //Path.setMap(map);

        //map.setTilt(45);
        infoWindow = new google.maps.InfoWindow;

        var marker = new google.maps.Marker({position: loc, map: map});

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                infoWindow.setPosition(pos);
                infoWindow.setContent('Location found.');
                infoWindow.open(map);

                marker.setPosition(pos);

                // infoWindow.setPosition(pos);
                // infoWindow.setContent('Location found.');
                //infoWindow.open(map);
                map.setCenter(pos);
            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        } else {
            handleLocationError(false, infoWindow, map.getCenter());
        }

        // var pathLayerGroup = new google.maps.Data({
        //     map: map,
        //     style: {
        //         strokeColor: '#753E24',
        //         strokeOpacity: 0.9,
        //         strokeWeight: 4
        //     }
        // });

//        var r;




        $.getJSON("greaterCincinnatiNight.json", function(data) {
            var r = data; //load from json
            //console.log(r.id);
            var points = [];

            for (var p = 0, pl = r.path.length; p < pl; p += 2)
                points.push({
                    lat: r.path[p],
                    lng: r.path[p + 1]
                });

            console.log("r.id : " + r.id);

            map.data.add({
                id: r.id,
                geometry: new google.maps.Data.LineString(points),
                properties: {
                    routeId: r.id,
                    strokeColor: "#dddddd",
                    strokeOpacity: 0.6,
                    strokeWeight: 10
                }
            });


            //
            // r.polyline = new google.maps.Data.Feature({
            //     id: r.id,
            //     geometry: new google.maps.Data.LineString(points),
            //     properties: {
            //         routeId: r.id,
            //         strokeColor: "#" + r.color,
            //         strokeOpacity: 0.6,
            //         strokeWeight: 10
            //     }
            // });
            // //
            // pathLayerGroup.add(r.polyline);
            //
            // var polylineBounds = new google.maps.LatLngBounds();
            // r.polyline.getGeometry().forEachLatLng(function(ll) {
            //     polylineBounds.extend(ll);
            // });
        });


        $.getJSON("stops.json", function(dat) {
            var s;
            var i = dat.length;

            while(i--){
                s = dat[i];
                //console.log([s.lat, s.lon]);

                map.data.add({
                    //id: ,
                    geometry: {lat: s.lat, lng: s.lon},
                    properties: {
                        routeId: i,
                        strokeColor: "#cccccc",
                        strokeOpacity: 0.6,
                        strokeWeight: 10
                    }
                });
            }

        });


    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
        infoWindow.setPosition(pos);
        infoWindow.setContent(browserHasGeolocation ?
            'Error: The Geolocation service failed.' :
            'Error: Your browser doesn\'t support geolocation.');
        infoWindow.open(map);
    }

</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvvZLiGG3yuew2zoDtZBmaUKdme_bx2Q0&v=3&callback=initMap"></script>
</body>
</html>